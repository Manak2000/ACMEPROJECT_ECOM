<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="signup.css">
</head>

<body>
    <div class="container">
        <div class="title">Registration</div>
        <div class="content">
            <form onsubmit="return submitForm();">
                <div class="user-details">
                    <div class="input-box">
                        <span class="details">Username</span>
                        <input type="text" id="uname" placeholder="Enter your username" required>
                    </div>

                    <div class="input-box">
                        <span class="details">Password</span>
                        <input type="password" id="upass" placeholder="Enter your password" required>
                    </div>

                    <div class="input-box">
                        <span class="details">Confirm Password</span>
                        <input type="password" id="upass2" placeholder="Confirm your password" required>
                    </div>

                    <div class="input-box" style="width:100%">
                        <span class="details">Select Role</span>
                        <select id="role" class="form-select" required>
                            <option value="vendor">Vendor</option>
                            <option value="customer">Customer</option>
                        </select>
                    </div>
                </div>

                <div class="text-center mt-3">
                    <button type="submit" class="btn btn-danger w-100">Register</button>
                </div>

                <div class="text-end mt-2">
                    <a href="login.html">Already a user? Login Here</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        async function submitForm() {
            try {
                let uname = document.getElementById("uname").value.trim();
                let upass = document.getElementById("upass").value;
                let upass2 = document.getElementById("upass2").value;
                let role = document.getElementById("role").value;

                if (uname.length < 3) {
                    alert("Username must be at least 3 characters long");
                    return false;
                }
                if (upass.length < 6) {
                    alert("Password must be at least 6 characters long");
                    return false;
                }
                if (upass !== upass2) {
                    alert("Passwords do not match");
                    return false;
                }

                const payload = { username: uname, password: upass, role: role };

                console.log("sending data:", payload); // debug log

                let response = await fetch("http://localhost:3000/auth/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                let responseData = await response.text();
                console.log("Server response:", responseData);
                alert("Registration successful!");
            } catch (err) {
                console.error(" Error:", err);
                alert("Error: Could not connect to server");
            }
            return false; // stop page reload
        




                    //callback hell
                    // handle_async.then((resolvedResponse) => {
                    //     handlesecondAsync().then(resp => {
                    //         console.log("third line is executed");
                    //     });
                    // })

                    // console.log("third line is executed");


                    // // setTimeout(() => {
                    // //     console.log("i am executed");

                    // // }, 2000);


                    //             let resolvedResponse= await handleAsync();
                    // console.log("resolved response:",resolvedResponse);
                    // console.log("second line executed after aynsc function"); console.log("third line is executed");

                    //             // // console.log("second line is executed here:");


                    //             function handle_async() {
                    //                 return new Promise((resolve, reject) => {

                    //                     try {
                    //                         setTimeout(() => {
                    //                             console.log("I am an async function with 2 sec delay");
                    //                             resolve("success");
                    //                         }, 2000);
                    //                     }
                    //                     catch (err) {
                    //                         reject(err)
                    //                     }
                    //                 })

                    //             }
                    //         }
                
        }
            </script>
</body>

</html>