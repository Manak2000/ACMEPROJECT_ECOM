<!DOCTYPE html>
<html lang="en">
<head>
<style>
    .card {
        display: inline-block;
        background-color: blueviolet;
        color: white;
        padding: 10px;
        width: 200px;

        margin: 5px;
    }

    #parent {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
    }

    #parent>div {
        border: 1px solid black;
        padding: 10px;
    }

    .price::before {
        content: "Rs.";
        font-size: 16px;
    }

    .detail {
        overflow: hidden;
      
    }
</style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<div id="parent"></div>
    <script>
      

    
        async function getProducts() {
            const token = sessionStorage.getItem("token");
            const parentobj = document.getElementById("parent");
            const response = await fetch('http://localhost:3000/product/getall', {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "authorization": token 
                }
            });

            const responseData = await response.json();
            console.log(responseData);

            if (responseData.error === false) {
                for (let i = 0; i < responseData.data.length; i++) {
                    const productData = responseData.data[i];

                    const div = document.createElement("div");
                    div.classList.add("card");
                    div.innerHTML = `
                        <img src="../${productData.impath}" alt="${productData.name}" width="150" height="150">
                        <div class="name">${productData.name}</div>
                        <div class="price">${productData.price}</div>
                        <div class="detail">${productData.detail}</div>
                        <div>
                            <button onclick="addToCart(${productData.pid})">addToCart</button>
                        </div>
                    `;
                     parentobj.appendChild(div);
                    
                }
            } else {
                alert(responseData.message);
            }
        }

        getProducts();

     async function addToCart(pid) {
            token = sessionStorage.getItem("token");
            if (!token) {
                alert("Please login first");
                location.href = "../login.html";
                return;
            }
        const response= await fetch('http://localhost:3000/cart/add', {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "authorization": token 
                },
                body: JSON.stringify({pid})
            })
            const responseData = await response.json(); 
            if(responseData.error===false){
                alert("Product added to cart");
            }
            else{
                alert(responseData.message);
            }
        }

        async function placeOrder() {
                const token = sessionStorage.getItem("token");

                if (!token) {
                    alert("Please login first");
                    location.href = "../login.html";
                    return;
                }

                try {
                    const response = await fetch("http://localhost:3000/order/place", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "authorization": token
                        }
                    });

                    const responseData = await response.json();
                    if (responseData.error === false) {
                        alert("Order placed successfully! Order ID: " + responseData.data.orderId);
                        // Optional: Clear cart or reload page
                    } else {
                        alert("Failed to place order: " + responseData.message);
                    }
                } catch (err) {
                    console.error("Error placing order:", err);
                    alert("Something went wrong. Try again later.");
                }
            }
    </script>
</body>
</html>