<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="signup.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>
    <div class="d-flex justify-content-center align-items-center vh-100">
        <form onsubmit="return submitForm();" class="bg-warning p-3" style="width:500px; border-radius:8px;">
            <h3 class="text-center">Login Here..</h3>
    
            <div class="user-details">
               
                <div class="input-box">
                    <span class="details">Username</span>
                    <input type="text" id="uname" placeholder="Enter your username" required>
                </div>
    
         
                <div class="input-box">
                    <span class="details">Password</span>
                    <input type="password" id="upass" placeholder="Enter your password" required>
                </div>
            </div>
    
            <div class="text-center mt-3">
                <button type="submit" class="btn btn-danger w-100">Login</button>
            </div>
    
            <div class="text-end mt-2">
                <a href="signup.html">New user? Register Here</a>
            </div>
        </form>
    </div>


    <script>
        async function submitForm() {
            let uname = document.getElementById("uname").value;
            let upass = document.getElementById("upass").value;


            if (uname.length < 3) {
                alert("Username must be at least 3 characters long");
                return;
            }
            if (upass.length < 6) {
                alert("Password must be at least 6 characters long");
                return;
            }


            const payload = {
                "username": uname,
                "password": upass,

            }
            let response = await fetch("http://localhost:3000/auth/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload),
            })

            let responseData = await response.json();
            console.log(responseData);


            if (responseData.error == false) {
                sessionStorage.setItem("token", responseData.data.token)
                alert("Login Successful");
                if (responseData.data.role.toLowerCase() == "vendor") {
                    location.href = "vendor/home.html"
                }
                else if (responseData.data.role.toLowerCase() == "customer") {
                    location.href = "customer/home.html"
                }

            }
            else {
                alert(responseData.message);
            }


            return false;



        }




        //callback hell
        // handle_async.then((resolvedResponse) => {
        //     handlesecondAsync().then(resp => {
        //         console.log("third line is executed");
        //     });
        // })

        // console.log("third line is executed");


        // // setTimeout(() => {
        // //     console.log("i am executed");

        // // }, 2000);


        //             let resolvedResponse= await handleAsync();
        // console.log("resolved response:",resolvedResponse);
        // console.log("second line executed after aynsc function"); console.log("third line is executed");

        //             // // console.log("second line is executed here:");


        //             function handle_async() {
        //                 return new Promise((resolve, reject) => {

        //                     try {
        //                         setTimeout(() => {
        //                             console.log("I am an async function with 2 sec delay");
        //                             resolve("success");
        //                         }, 2000);
        //                     }
        //                     catch (err) {
        //                         reject(err)
        //                     }
        //                 })

        //             }
        //         }


    </script>
</body>

</html>